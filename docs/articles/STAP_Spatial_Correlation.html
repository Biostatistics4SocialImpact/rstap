<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STAP-Spatial_Correlation • rstap</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="STAP-Spatial_Correlation">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstap</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/STAP_Introduction.html">STAP Introduction</a>
    </li>
    <li>
      <a href="../articles/STAP_Spatial_Correlation.html">STAP-Spatial_Correlation</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>STAP-Spatial_Correlation</h1>
                        <h4 class="author">Adam Peterson</h4>
            
            <h4 class="date">2018-08-06</h4>
      
      
      <div class="hidden name"><code>STAP_Spatial_Correlation.Rmd</code></div>

    </div>

    
    
<p>To induce correlation between business locations, we generate the x and y coordinates from an inhomogenous poisson process, with intensity function <span class="math inline">\(f(x,y) = 200xy\)</span>. We continue to generate subjects uniformly across the space.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2524</span>)
num_subj &lt;-<span class="st"> </span><span class="dv">550</span>
intenfun &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="dv">200</span> <span class="op">*</span><span class="st"> </span>x <span class="op">*</span>y
bef_rpp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/rpoispp">rpoispp</a></span>(intenfun, <span class="dt">lmax =</span> <span class="fl">5E3</span>)
bef_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> bef_rpp<span class="op">$</span>x,
                     <span class="dt">y =</span> bef_rpp<span class="op">$</span>y, <span class="dt">class =</span> <span class="st">'BEF'</span>)
sub_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_subj, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">1.0</span>),
                     <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_subj, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">1.0</span>),
                     <span class="dt">class =</span> <span class="st">"Subject"</span>)
<span class="kw">rbind</span>(bef_df,sub_df) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">color=</span>class)) <span class="op">+</span><span class="st"> </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">theme_bw</span>() <span class="op">+</span><span class="st"> </span><span class="kw">ggtitle</span>(<span class="st">"Correlated Business Positions"</span>)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-1-1.png" width="700"></p>
<p>Then suppose the form of some measurement on the subjects is:</p>
<p><span class="math display">\[
E[Y_i] = \alpha + Z_i \delta + X_i(\theta)\beta_2\\
X_i(\theta) = \sum_{d \in \mathcal{D}_i} \text{erfc}(\frac{d}{\theta})
\]</span> Here we use the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="fl">22.5</span>
Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> num_subj, <span class="dt">prob =</span> .<span class="dv">45</span>, <span class="dt">size =</span> <span class="dv">1</span>)
delta &lt;-<span class="st"> </span><span class="op">-</span>.<span class="dv">8</span>
theta &lt;-<span class="st"> </span>.<span class="dv">3</span>
beta &lt;-<span class="st"> </span><span class="fl">1.2</span>
sigma &lt;-<span class="st"> </span><span class="fl">2.3</span></code></pre></div>
<p>supposing we use all the data available (no exclusion distance), then this results in the following dataset</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dists &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]),
                       <span class="kw">as.matrix</span>(bef_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))
X &lt;-<span class="st"> </span><span class="kw">apply</span>(dists,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(x<span class="op">/</span>theta)))
X_tilde &lt;-<span class="st"> </span>(X<span class="op">-</span><span class="kw">mean</span>(X))<span class="op">/</span><span class="kw">sd</span>(X) ## center and scale the exposure effect
y &lt;-<span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span>Z<span class="op">*</span>delta <span class="op">+</span><span class="st"> </span>X_tilde<span class="op">*</span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> num_subj, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma)
<span class="kw">hist</span>(y)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(dists), <span class="dt">by =</span> <span class="fl">0.01</span>)
X_theta_one &lt;-<span class="st"> </span>pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span>theta)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(d,X_theta_one,<span class="dt">type=</span><span class="st">'l'</span>,<span class="dt">main =</span> <span class="st">"Exposure Decay Function"</span>, <span class="dt">xlab =</span> <span class="st">"Distance"</span>,
     <span class="dt">ylab =</span> <span class="st">"Exposure"</span>)
<span class="kw">hist</span>(X_tilde)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>Then we model this with rstap in the following manner</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distance_data &lt;-<span class="st"> </span>dists <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">gather</span>(<span class="kw">contains</span>(<span class="st">"V"</span>), <span class="dt">key =</span> <span class="st">'BEF'</span>,<span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BEF =</span> <span class="st">'Fast_Food'</span>)

subject_data &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj,
                           <span class="dt">y =</span> y,
                           <span class="dt">sex =</span> <span class="kw">factor</span>(Z,<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"M"</span>,<span class="st">"F"</span>)))

fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">stap</span>(Fast_Food),
                <span class="dt">subject_data =</span> subject_data,
                <span class="dt">distance_data =</span> distance_data,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">25</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">1</span>) ## include all data
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 0.008116 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 81.16 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Iteration:    1 / 2000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  200 / 2000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  400 / 2000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  600 / 2000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  800 / 2000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1000 / 2000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1001 / 2000 [ 50%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1200 / 2000 [ 60%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1400 / 2000 [ 70%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1600 / 2000 [ 80%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1800 / 2000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 2000 / 2000 [100%]  (Sampling)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 38.9271 seconds (Warm-up)</span>
<span class="co">#&gt;                34.4651 seconds (Sampling)</span>
<span class="co">#&gt;                73.3922 seconds (Total)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(alpha,delta,beta,theta),<span class="kw">coef</span>(fit))
<span class="kw">rownames</span>(results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"True"</span>,<span class="st">"Estimated"</span>)
results
<span class="co">#&gt;           (Intercept)       sexF Fast_Food Fast_Food_spatial_scale</span>
<span class="co">#&gt; True          22.5000 -0.8000000   1.20000               0.3000000</span>
<span class="co">#&gt; Estimated     22.4277 -0.8853724   1.20657               0.4295096</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw"><a href="../reference/se.html">se</a></span>(fit)
<span class="co">#&gt;             (Intercept)                    sexF               Fast_Food </span>
<span class="co">#&gt;              0.12820110              0.18597310              0.09752372 </span>
<span class="co">#&gt; Fast_Food_spatial_scale </span>
<span class="co">#&gt;              0.09280066</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">set.seed</span>(<span class="dv">2524</span>)
intenfun &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="dv">250</span> <span class="op">*</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>y
bef_rpp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/rpoispp">rpoispp</a></span>(intenfun, <span class="dt">lmax =</span> <span class="dv">500</span>)
bef_df &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">x =</span> bef_rpp<span class="op">$</span>x,
                     <span class="dt">y =</span> bef_rpp<span class="op">$</span>y, <span class="dt">class =</span> <span class="st">'BEF_1'</span>)
intenfun &lt;-<span class="st"> </span><span class="cf">function</span>(x,y) <span class="dv">250</span> <span class="op">*</span><span class="st"> </span>x <span class="op">*</span><span class="st"> </span>y
bef_rpp &lt;-<span class="st"> </span>spatstat<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/spatstat/topics/rpoispp">rpoispp</a></span>(intenfun, <span class="dt">lmax =</span> <span class="dv">500</span>)
bef_df &lt;-<span class="st"> </span><span class="kw">rbind</span>(bef_df,<span class="kw">data_frame</span>(<span class="dt">x =</span> bef_rpp<span class="op">$</span>x,
                     <span class="dt">y =</span> bef_rpp<span class="op">$</span>y, <span class="dt">class =</span> <span class="st">'BEF_2'</span>))
<span class="kw">rbind</span>(bef_df) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">color=</span>class)) <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw">geom_point</span>() <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>()</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-7-1.png" width="700"> Then suppose the form of some measurement on the subjects is:</p>
<p><span class="math display">\[
E[Y_i] = \alpha + Z_i \delta + X_{i,1}(\theta_1)\beta_2 + X_{i,2}(\theta_2)\beta_3 \\
X_{i,j}(\theta) = \sum_{d \in \mathcal{D}_i} \text{erfc}(\frac{d}{\theta_j}) \quad j = 1,2
\]</span> Here we use the following</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="fl">22.5</span>
Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> num_subj, <span class="dt">prob =</span> .<span class="dv">45</span>, <span class="dt">size =</span> <span class="dv">1</span>)
delta &lt;-<span class="st"> </span><span class="op">-</span>.<span class="dv">8</span>
theta &lt;-<span class="st"> </span>.<span class="dv">3</span>
theta_<span class="dv">2</span> &lt;-<span class="st"> </span>.<span class="dv">9</span>
beta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.2</span>,.<span class="dv">5</span>)
sigma &lt;-<span class="st"> </span><span class="fl">2.3</span></code></pre></div>
<p>supposing we (again) use all the data available (no exclusion distance), then this results in the following dataset</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dists_<span class="dv">1</span> &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]),
                       <span class="kw">as.matrix</span>(bef_df[bef_df<span class="op">$</span>class<span class="op">==</span><span class="st">'BEF_1'</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))
X_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">apply</span>(dists_<span class="dv">1</span>,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(x<span class="op">/</span>theta)))
X_tilde &lt;-<span class="st"> </span>(X_<span class="dv">1</span><span class="op">-</span><span class="kw">mean</span>(X_<span class="dv">1</span>))<span class="op">/</span><span class="kw">sd</span>(X_<span class="dv">1</span>) ## center and scale the exposure effect
dists_<span class="dv">2</span> &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]),
                       <span class="kw">as.matrix</span>(bef_df[bef_df<span class="op">$</span>class<span class="op">==</span><span class="st">'BEF_2'</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))
X_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">apply</span>(dists_<span class="dv">2</span>,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(x<span class="op">/</span>theta_<span class="dv">2</span>)))
X_tilde &lt;-<span class="st"> </span><span class="kw">cbind</span>(X_tilde,(X_<span class="dv">2</span><span class="op">-</span><span class="kw">mean</span>(X_<span class="dv">2</span>))<span class="op">/</span><span class="kw">sd</span>(X_<span class="dv">2</span>))
y &lt;-<span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span>Z<span class="op">*</span>delta <span class="op">+</span><span class="st"> </span>X_tilde <span class="op">%*%</span><span class="st"> </span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> num_subj, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(y)
<span class="kw">hist</span>(dists)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(dists), <span class="dt">by =</span> <span class="fl">0.01</span>)
X_theta_one &lt;-<span class="st"> </span>pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span>theta)
X_theta_two &lt;-<span class="st"> </span>pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span>theta_<span class="dv">2</span>)
<span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>),<span class="dt">mar=</span><span class="kw">rep</span>(<span class="dv">1</span>,<span class="dv">4</span>))
<span class="kw">plot</span>(d,X_theta_one,<span class="dt">type=</span><span class="st">'l'</span>,<span class="dt">main =</span> <span class="st">"Exposure Decay Function BEF 1"</span>, <span class="dt">xlab =</span> <span class="st">"Distance"</span>, <span class="dt">ylab =</span> <span class="st">"Exposure"</span>)
<span class="kw">plot</span>(d,X_theta_two,<span class="dt">type=</span><span class="st">'l'</span>, <span class="dt">main =</span> <span class="st">"Exposure Decay Function BEF 2"</span>)
<span class="kw">hist</span>(X_tilde[,<span class="dv">1</span>])
<span class="kw">hist</span>(X_tilde[,<span class="dv">2</span>])</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Since the businesses, let’s say Fast Food Restaurants and Coffee shops, were generated using the same intensity function from an inhomogenous poisson model, we should expect the exposure to be correlated, since these businesses tend to be located in the same area - as indeed, they may be in real life as well.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">cor</span>(X_tilde[,<span class="dv">1</span>],X_tilde[,<span class="dv">2</span>])
<span class="co">#&gt; [1] 0.9193313</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(X_<span class="dv">1</span>,X_<span class="dv">2</span>, <span class="dt">xlab =</span> <span class="st">"FFR Exposure"</span>, <span class="dt">ylab =</span> <span class="st">"Coffee Exposure"</span>,
     <span class="dt">main =</span> <span class="st">"Exposure Correlation"</span>)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-12-1.png" width="700"></p>
<p>This may cause problems in our modeling, but we should check to make sure.</p>
<p>Then we model this with rstap in the following manner</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distance_data &lt;-<span class="st"> </span>dists_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">gather</span>(<span class="kw">contains</span>(<span class="st">"V"</span>), <span class="dt">key =</span> <span class="st">'BEF'</span>,<span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BEF =</span> <span class="st">'Fast_Food'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">rbind</span>(dists_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">gather</span>(<span class="kw">contains</span>(<span class="st">"V"</span>), <span class="dt">key =</span><span class="st">'BEF'</span>, <span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">BEF =</span> <span class="st">'Coffee_Shops'</span>))

subject_data &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj,
                           <span class="dt">y =</span> <span class="kw">as.vector</span>(y),
                           <span class="dt">sex =</span> <span class="kw">factor</span>(Z,<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"M"</span>,<span class="st">"F"</span>)))

fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">stap</span>(Fast_Food) <span class="op">+</span><span class="st"> </span><span class="kw">stap</span>(Coffee_Shops),
                <span class="dt">subject_data =</span> subject_data,
                <span class="dt">distance_data =</span> distance_data,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">5</span>,<span class="dt">autoscale =</span> F),
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">25</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">1</span>) ## include all data
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 0.007669 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 76.69 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Iteration:    1 / 2000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  200 / 2000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  400 / 2000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  600 / 2000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  800 / 2000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1000 / 2000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1001 / 2000 [ 50%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1200 / 2000 [ 60%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1400 / 2000 [ 70%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1600 / 2000 [ 80%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1800 / 2000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 2000 / 2000 [100%]  (Sampling)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 200.456 seconds (Warm-up)</span>
<span class="co">#&gt;                152.957 seconds (Sampling)</span>
<span class="co">#&gt;                353.413 seconds (Total)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(alpha,delta,beta,theta,theta_<span class="dv">2</span>),<span class="kw">coef</span>(fit))
<span class="kw">rownames</span>(results) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"True"</span>,<span class="st">"Estimated"</span>)
results
<span class="co">#&gt;           (Intercept)       sexF Fast_Food Coffee_Shops</span>
<span class="co">#&gt; True         22.50000 -0.8000000  1.200000    0.5000000</span>
<span class="co">#&gt; Estimated    22.47067 -0.8193664  1.152086    0.4015794</span>
<span class="co">#&gt;           Fast_Food_spatial_scale Coffee_Shops_spatial_scale</span>
<span class="co">#&gt; True                    0.3000000                   0.900000</span>
<span class="co">#&gt; Estimated               0.2598541                   1.213853</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit<span class="op">$</span>ses
<span class="co">#&gt;                (Intercept)                       sexF </span>
<span class="co">#&gt;                 0.12643135                 0.20377254 </span>
<span class="co">#&gt;                  Fast_Food               Coffee_Shops </span>
<span class="co">#&gt;                 0.33620101                 0.35404959 </span>
<span class="co">#&gt;    Fast_Food_spatial_scale Coffee_Shops_spatial_scale </span>
<span class="co">#&gt;                 0.07659055                 0.86640681</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(X_tilde) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"Fast_Food"</span>,<span class="st">"Coffee_Shops"</span>)
fit_lm &lt;-<span class="st"> </span><span class="kw">lm</span>(y <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span>Fast_Food <span class="op">+</span><span class="st"> </span>Coffee_Shops,<span class="dt">data=</span><span class="kw">cbind</span>(subject_data,X_tilde))
<span class="kw">summary</span>(fit_lm)
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = y ~ sex + Fast_Food + Coffee_Shops, data = cbind(subject_data, </span>
<span class="co">#&gt;     X_tilde))</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -7.1064 -1.4780  0.0948  1.4595  6.2257 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;              Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)   22.4730     0.1283 175.104  &lt; 2e-16 ***</span>
<span class="co">#&gt; sexF          -0.8391     0.1923  -4.363 1.53e-05 ***</span>
<span class="co">#&gt; Fast_Food      1.2253     0.2431   5.040 6.34e-07 ***</span>
<span class="co">#&gt; Coffee_Shops   0.2979     0.2431   1.225    0.221    </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 2.241 on 546 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.3285, Adjusted R-squared:  0.3248 </span>
<span class="co">#&gt; F-statistic: 89.05 on 3 and 546 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cors &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(fit<span class="op">$</span>x_tilde), <span class="cf">function</span>(x) <span class="kw">cor</span>(fit<span class="op">$</span>x_tilde[x,,<span class="dv">1</span>],fit<span class="op">$</span>x_tilde[x,,<span class="dv">2</span>], <span class="dt">method=</span><span class="st">'spearman'</span>))
<span class="kw">summary</span>(cors)
<span class="co">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
<span class="co">#&gt;  0.3122  0.4593  0.4870  0.4823  0.5136  0.5486</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">b &lt;-<span class="st"> </span>rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanfit-method-extract">extract</a></span>(fit<span class="op">$</span>stapfit)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(b<span class="op">$</span>theta[,<span class="dv">1</span>],<span class="dt">main=</span><span class="st">"FFR Spatial Scale"</span>)
<span class="kw">hist</span>(b<span class="op">$</span>theta[,<span class="dv">2</span>],<span class="dt">main=</span><span class="st">"Coffee Spatial Scale"</span>)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>If the effect of coffee shops becomes stronger…</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="fl">22.5</span>
Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> num_subj, <span class="dt">prob =</span> .<span class="dv">45</span>, <span class="dt">size =</span> <span class="dv">1</span>)
delta &lt;-<span class="st"> </span><span class="op">-</span>.<span class="dv">8</span>
theta &lt;-<span class="st"> </span>.<span class="dv">3</span>
theta_<span class="dv">2</span> &lt;-<span class="st"> </span>.<span class="dv">9</span>
beta &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="fl">1.2</span>,<span class="fl">2.5</span>)
sigma &lt;-<span class="st"> </span><span class="fl">2.3</span></code></pre></div>
<p>supposing we use all the data available (no exclusion distance), then this results in the following dataset</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dists_<span class="dv">1</span> &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]),
                       <span class="kw">as.matrix</span>(bef_df[bef_df<span class="op">$</span>class<span class="op">==</span><span class="st">'BEF_1'</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))
X_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">apply</span>(dists_<span class="dv">1</span>,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(x<span class="op">/</span>theta)))
X_tilde &lt;-<span class="st"> </span>(X_<span class="dv">1</span><span class="op">-</span><span class="kw">mean</span>(X_<span class="dv">1</span>))<span class="op">/</span><span class="kw">sd</span>(X_<span class="dv">1</span>) ## center and scale the exposure effect
dists_<span class="dv">2</span> &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]),
                       <span class="kw">as.matrix</span>(bef_df[bef_df<span class="op">$</span>class<span class="op">==</span><span class="st">'BEF_2'</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]))
X_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">apply</span>(dists_<span class="dv">2</span>,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(x<span class="op">/</span>theta_<span class="dv">2</span>)))
X_tilde &lt;-<span class="st"> </span><span class="kw">cbind</span>(X_tilde,(X_<span class="dv">2</span><span class="op">-</span><span class="kw">mean</span>(X_<span class="dv">2</span>))<span class="op">/</span><span class="kw">sd</span>(X_<span class="dv">2</span>))
y &lt;-<span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span>Z<span class="op">*</span>delta <span class="op">+</span><span class="st"> </span>X_tilde <span class="op">%*%</span><span class="st"> </span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> num_subj, <span class="dt">mean =</span> <span class="dv">0</span>, <span class="dt">sd =</span> sigma)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(y)</code></pre></div>
<p><img src="STAP_Spatial_Correlation_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">distance_data &lt;-<span class="st"> </span>dists_<span class="dv">1</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">gather</span>(<span class="kw">contains</span>(<span class="st">"V"</span>), <span class="dt">key =</span> <span class="st">'BEF'</span>,<span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">mutate</span>(<span class="dt">BEF =</span> <span class="st">'Fast_Food'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw">rbind</span>(dists_<span class="dv">2</span> <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as_data_frame</span>() <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">gather</span>(<span class="kw">contains</span>(<span class="st">"V"</span>), <span class="dt">key =</span><span class="st">'BEF'</span>, <span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">              </span><span class="kw">mutate</span>(<span class="dt">BEF =</span> <span class="st">'Coffee_Shops'</span>))

subject_data &lt;-<span class="st"> </span><span class="kw">data_frame</span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj,
                           <span class="dt">y =</span> <span class="kw">as.vector</span>(y),
                           <span class="dt">sex =</span> <span class="kw">factor</span>(Z,<span class="dt">labels=</span><span class="kw">c</span>(<span class="st">"M"</span>,<span class="st">"F"</span>)))

fit_CF &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> y <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">stap</span>(Fast_Food) <span class="op">+</span><span class="st"> </span><span class="kw">stap</span>(Coffee_Shops),
                <span class="dt">subject_data =</span> subject_data,
                <span class="dt">distance_data =</span> distance_data,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">5</span>,<span class="dt">autoscale =</span> F),
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">25</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">1</span>) ## include all data
<span class="co">#&gt; </span>
<span class="co">#&gt; SAMPLING FOR MODEL 'continuous' NOW (CHAIN 1).</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Gradient evaluation took 0.004644 seconds</span>
<span class="co">#&gt; 1000 transitions using 10 leapfrog steps per transition would take 46.44 seconds.</span>
<span class="co">#&gt; Adjust your expectations accordingly!</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Iteration:    1 / 2000 [  0%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  200 / 2000 [ 10%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  400 / 2000 [ 20%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  600 / 2000 [ 30%]  (Warmup)</span>
<span class="co">#&gt; Iteration:  800 / 2000 [ 40%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1000 / 2000 [ 50%]  (Warmup)</span>
<span class="co">#&gt; Iteration: 1001 / 2000 [ 50%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1200 / 2000 [ 60%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1400 / 2000 [ 70%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1600 / 2000 [ 80%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 1800 / 2000 [ 90%]  (Sampling)</span>
<span class="co">#&gt; Iteration: 2000 / 2000 [100%]  (Sampling)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Elapsed Time: 301.978 seconds (Warm-up)</span>
<span class="co">#&gt;                291.927 seconds (Sampling)</span>
<span class="co">#&gt;                593.905 seconds (Total)</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">results_CF &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(alpha,delta,beta,theta,theta_<span class="dv">2</span>),<span class="kw">coef</span>(fit_CF))
<span class="kw">rownames</span>(results_CF) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">"True"</span>,<span class="st">"Estimated"</span>)
results_CF
<span class="co">#&gt;           (Intercept)       sexF Fast_Food Coffee_Shops</span>
<span class="co">#&gt; True         22.50000 -0.8000000  1.200000     2.500000</span>
<span class="co">#&gt; Estimated    22.38903 -0.7991213  1.782837     1.752011</span>
<span class="co">#&gt;           Fast_Food_spatial_scale Coffee_Shops_spatial_scale</span>
<span class="co">#&gt; True                    0.3000000                  0.9000000</span>
<span class="co">#&gt; Estimated               0.3354129                  0.9332912</span></code></pre></div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
