<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mis-Specified Weight Function • rstap</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Mis-Specified Weight Function">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstap</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">STAP Introduction</a>
    </li>
    <li>
      <a href="../articles/Spatial_Correlation_I.html">STAP-Spatial_Correlation</a>
    </li>
    <li>
      <a href="../articles/hawkes-processes.html">Spatial Correlation II</a>
    </li>
    <li>
      <a href="../articles/longitudinal-i.html">Vignette Title</a>
    </li>
    <li>
      <a href="../articles/misspecified-kernel.html">Mis-Specified Weight Function</a>
    </li>
    <li>
      <a href="../articles/scale-priors.html">Scale Priors</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Mis-Specified Weight Function</h1>
                        <h4 class="author">Adam Peterson</h4>
            
            <h4 class="date">2018-09-04</h4>
      
      
      <div class="hidden name"><code>misspecified-kernel.Rmd</code></div>

    </div>

    
    
<p>The STAP framework requires a specified weight function, that desribes the rate at which the effect of the built environment feature either accumulates or decays across time or space respectively. This vignette explores and explains what happens when that weight function is mis-specified.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rstap)
<span class="kw">library</span>(dplyr)
<span class="co">#&gt; Warning: package 'dplyr' was built under R version 3.5.1</span>
<span class="kw">library</span>(tidyr)
<span class="kw">library</span>(ggplot2)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">num_subj &lt;-<span class="st"> </span><span class="fl">5E2</span>
num_bef &lt;-<span class="st"> </span><span class="dv">50</span>
sub_df &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_subj, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="fl">2.0</span>),
                     <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_subj, <span class="dt">min =</span> <span class="dv">1</span>, <span class="dt">max =</span> <span class="fl">2.0</span>),
                     <span class="dt">class =</span> <span class="st">"Subject"</span>)
bef_df &lt;-<span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">data_frame</a></span>(<span class="dt">x =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_bef, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">3.0</span>),
                     <span class="dt">y =</span> <span class="kw">runif</span>(<span class="dt">n =</span> num_bef, <span class="dt">min =</span> <span class="dv">0</span>, <span class="dt">max =</span> <span class="fl">3.0</span>),
                     <span class="dt">class =</span> <span class="st">"BEF"</span>)

<span class="kw">rbind</span>(sub_df,bef_df) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>x,<span class="dt">y=</span>y,<span class="dt">color =</span> class)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_point">geom_point</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Subject, BEF Spatial Arrangement"</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/set-up-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">alpha &lt;-<span class="st"> </span><span class="dv">24</span>
Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(<span class="dt">n =</span> num_subj,<span class="dt">size =</span> <span class="dv">1</span>,<span class="dt">prob =</span> .<span class="dv">5</span>)
delta &lt;-<span class="st"> </span><span class="op">-</span>.<span class="dv">8</span>
beta &lt;-<span class="st"> </span>.<span class="dv">92</span>
theta_FF &lt;-<span class="st"> </span><span class="fl">2.00</span>
sigma &lt;-<span class="st"> </span><span class="fl">1.3</span>
true_pars &lt;-<span class="st"> </span><span class="kw">c</span>(alpha,delta,beta,theta_FF)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dists &lt;-<span class="st"> </span>fields<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/fields/topics/rdist">rdist</a></span>(<span class="kw">as.matrix</span>(sub_df[,<span class="kw">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)]),
                       <span class="kw">as.matrix</span>(bef_df[,<span class="kw">c</span>(<span class="st">"x"</span>,<span class="st">"y"</span>)]))
unif_kernel &lt;-<span class="st"> </span><span class="cf">function</span>(x,theta) <span class="kw">return</span>( <span class="dv">1</span><span class="op">*</span>(x<span class="op">&lt;=</span>theta)  )
X &lt;-<span class="st"> </span><span class="kw">apply</span>(dists,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">unif_kernel</span>(x,theta_FF)))
X_tilde &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">scale</span>(X))
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(dists)
<span class="kw">hist</span>(X)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/distances-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">BMI &lt;-<span class="st"> </span>alpha <span class="op">+</span><span class="st"> </span>Z<span class="op">*</span>delta <span class="op">+</span><span class="st"> </span>X_tilde<span class="op">*</span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> num_subj,<span class="dt">mean =</span> <span class="dv">0</span>,<span class="dt">sd =</span> sigma)
<span class="kw">hist</span>(BMI)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/y_creation-1.png" width="700"></p>
<p>We’ll now model these data in the rstap framework, but since rstap’s estimation engine uses HMC, we can’t use a weight function that has a step-function. Instead we’ll use the usual complementary error function.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subj_df &lt;-<span class="st"> </span>sub_df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">BMI =</span> BMI,
                              <span class="dt">sex =</span> Z,
                              <span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span>num_subj)

dist_df &lt;-<span class="st"> </span>dists <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">as_data_frame</a></span>() <span class="op">%&gt;%</span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">subj_id =</span> <span class="dv">1</span><span class="op">:</span><span class="kw">nrow</span>(subj_df)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">contains</a></span>(<span class="st">"V"</span>), <span class="dt">key =</span> <span class="st">'BEF'</span>,<span class="dt">value =</span> <span class="st">'Distance'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">BEF =</span> <span class="st">'Fast_Food'</span>)

fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> BMI <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">sap</span>(Fast_Food),
                <span class="dt">subject_data =</span> subj_df,
                <span class="dt">distance_data =</span> dist_df,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="fl">26.2</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">1</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit
<span class="co">#&gt; stap_glm</span>
<span class="co">#&gt;  family:       gaussian [identity]</span>
<span class="co">#&gt;  formula:      BMI ~ sex + sap(Fast_Food)</span>
<span class="co">#&gt;  observations: 500</span>
<span class="co">#&gt;  Intercept:  TRUE</span>
<span class="co">#&gt;  fixed predictors:   </span>
<span class="co">#&gt;  spatial predictors:  1</span>
<span class="co">#&gt;  temporal predictors:  0</span>
<span class="co">#&gt; ------</span>
<span class="co">#&gt;                         Median MAD_SD</span>
<span class="co">#&gt; (Intercept)             24.0    0.1  </span>
<span class="co">#&gt; sex                     -0.8    0.1  </span>
<span class="co">#&gt; Fast_Food                0.5    0.1  </span>
<span class="co">#&gt; Fast_Food_spatial_scale  9.9    5.3  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Auxiliary parameter(s):</span>
<span class="co">#&gt;       Median MAD_SD</span>
<span class="co">#&gt; sigma 1.5    0.0   </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Sample avg. posterior predictive distribution of y:</span>
<span class="co">#&gt;          Median MAD_SD</span>
<span class="co">#&gt; mean_PPD 23.6    0.1  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ------</span>
<span class="co">#&gt; * For help interpreting the printed output see ?print.stapreg</span>
<span class="co">#&gt; * For info on the priors used see ?prior_summary.stapreg</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.matrix</span>(fit) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">as_data_frame</a></span>() <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">prior =</span> <span class="kw">rlnorm</span>(<span class="dt">n=</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>(),<span class="dt">meanlog =</span> <span class="dv">1</span>,<span class="dt">sdlog =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>(),<span class="dt">key =</span><span class="st">'parameter'</span>,<span class="dt">value =</span> <span class="st">'sample'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(parameter<span class="op">%in%</span><span class="kw">c</span>(<span class="st">"Fast_Food_spatial_scale"</span>,<span class="st">"prior"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>sample,<span class="dt">color=</span>parameter)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Prior vs. Posterior Comparison"</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-2-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(dists), <span class="dt">by =</span> <span class="fl">0.01</span>)
cerf_w &lt;-<span class="st"> </span>pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw">coef</span>(fit)[<span class="dv">4</span>])
unif_w &lt;-<span class="st"> </span><span class="kw">unif_kernel</span>(d,theta_FF)
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">plot</span>(d,cerf_w, <span class="dt">main =</span> <span class="st">"Cerf Weight"</span>, <span class="dt">type=</span><span class="st">'l'</span>)
<span class="kw">points</span>(d,pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">1</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">points</span>(d,pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">2</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>,<span class="dt">lty=</span><span class="dv">2</span>)
<span class="kw">plot</span>(d,unif_w, <span class="dt">main =</span> <span class="st">"Unif Weight"</span>, <span class="dt">type=</span><span class="st">'l'</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>For a different, more closely related weight function, the discrepancy might not be as bad.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">X &lt;-<span class="st"> </span><span class="kw">apply</span>(dists,<span class="dv">1</span>,<span class="cf">function</span>(x) <span class="kw">sum</span>(<span class="kw">exp</span>(<span class="op">-</span>x<span class="op">/</span>theta_FF)) )
X_tilde &lt;-<span class="st"> </span><span class="kw">as.matrix</span>(<span class="kw">scale</span>(X))
<span class="kw">par</span>(<span class="dt">mfrow=</span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))
<span class="kw">hist</span>(X)
<span class="kw">hist</span>(X_tilde)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subj_df<span class="op">$</span>BMI &lt;-<span class="st"> </span><span class="kw">as.vector</span>(alpha <span class="op">+</span><span class="st"> </span>Z<span class="op">*</span>delta <span class="op">+</span><span class="st"> </span>X_tilde<span class="op">*</span>beta <span class="op">+</span><span class="st"> </span><span class="kw">rnorm</span>(<span class="dt">n =</span> num_subj,<span class="dt">mean =</span> <span class="dv">0</span>,<span class="dt">sd =</span> sigma))

fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> BMI <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">sap</span>(Fast_Food),
                <span class="dt">subject_data =</span> subj_df,
                <span class="dt">distance_data =</span> dist_df,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="fl">26.2</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">1</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.matrix</span>(fit) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">as_data_frame</a></span>() <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">prior =</span> <span class="kw">rlnorm</span>(<span class="dt">n=</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>(),<span class="dt">meanlog =</span> <span class="dv">1</span>,<span class="dt">sdlog =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>(),<span class="dt">key =</span><span class="st">'parameter'</span>,<span class="dt">value =</span> <span class="st">'sample'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(parameter<span class="op">%in%</span><span class="kw">c</span>(<span class="st">"Fast_Food_spatial_scale"</span>,<span class="st">"prior"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>sample,<span class="dt">color=</span>parameter)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Prior vs. Posterior Comparison"</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(dists), <span class="dt">by =</span> <span class="fl">0.01</span>)
cerf_w &lt;-<span class="st"> </span>pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw">coef</span>(fit)[<span class="dv">4</span>])
exp_w &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>d<span class="op">/</span>theta_FF)
<span class="kw">plot</span>(d,cerf_w, <span class="dt">main =</span> <span class="st">"Cerf Weight"</span>, <span class="dt">type=</span><span class="st">'l'</span>)
<span class="kw">points</span>(d,pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">1</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">points</span>(d,pracma<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/pracma/topics/erfz">erfc</a></span>(d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">2</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">points</span>(d,exp_w, <span class="dt">main =</span> <span class="st">"Exponential Weight"</span>, <span class="dt">type=</span><span class="st">'l'</span>,<span class="dt">col=</span><span class="st">'blue'</span>,<span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">fit &lt;-<span class="st"> </span><span class="kw"><a href="../reference/stap_glm.html">stap_glm</a></span>(<span class="dt">formula =</span> BMI <span class="op">~</span><span class="st"> </span>sex <span class="op">+</span><span class="st"> </span><span class="kw">sap</span>(Fast_Food,exp),
                <span class="dt">subject_data =</span> subj_df,
                <span class="dt">distance_data =</span> dist_df,
                <span class="dt">family =</span> <span class="kw">gaussian</span>(<span class="dt">link =</span> <span class="st">'identity'</span>),
                <span class="dt">id_key =</span> <span class="st">'subj_id'</span>,
                <span class="dt">prior =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_intercept =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="fl">26.2</span>, <span class="dt">scale =</span> <span class="dv">5</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_stap =</span> <span class="kw"><a href="../reference/priors.html">normal</a></span>(<span class="dt">location =</span> <span class="dv">0</span>, <span class="dt">scale =</span> <span class="dv">3</span>, <span class="dt">autoscale =</span> F),
                <span class="dt">prior_theta =</span> <span class="kw"><a href="../reference/priors.html">log_normal</a></span>(<span class="dt">location =</span> <span class="dv">1</span>, <span class="dt">scale =</span> <span class="dv">1</span>), 
                <span class="dt">prior_aux =</span> <span class="kw"><a href="../reference/priors.html">cauchy</a></span>(<span class="dt">location =</span> <span class="dv">0</span>,<span class="dt">scale =</span> <span class="dv">5</span>),
                <span class="dt">max_distance =</span> <span class="kw">max</span>(dists), <span class="dt">chains =</span> <span class="dv">2</span>, <span class="dt">cores =</span> <span class="dv">2</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.matrix</span>(fit) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">as_data_frame</a></span>() <span class="op">%&gt;%</span><span class="st">  </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span>(<span class="dt">prior =</span> <span class="kw">rlnorm</span>(<span class="dt">n=</span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/n.html">n</a></span>(),<span class="dt">meanlog =</span> <span class="dv">1</span>,<span class="dt">sdlog =</span> <span class="dv">1</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/tidyr/topics/gather">gather</a></span>(<span class="kw"><a href="http://dplyr.tidyverse.org/reference/reexports.html">everything</a></span>(),<span class="dt">key =</span><span class="st">'parameter'</span>,<span class="dt">value =</span> <span class="st">'sample'</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://dplyr.tidyverse.org/reference/filter.html">filter</a></span>(parameter<span class="op">%in%</span><span class="kw">c</span>(<span class="st">"Fast_Food_spatial_scale"</span>,<span class="st">"prior"</span>)) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggplot">ggplot</a></span>(<span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/aes">aes</a></span>(<span class="dt">x=</span>sample,<span class="dt">color=</span>parameter)) <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_density">geom_density</a></span>() <span class="op">+</span><span class="st"> </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/ggtheme">theme_bw</a></span>() <span class="op">+</span><span class="st"> </span>
<span class="st">    </span><span class="kw"><a href="http://www.rdocumentation.org/packages/ggplot2/topics/labs">ggtitle</a></span>(<span class="st">"Prior vs. Posterior Comparison"</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">d &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dt">from =</span> <span class="dv">0</span>, <span class="dt">to =</span> <span class="kw">max</span>(dists), <span class="dt">by =</span> <span class="fl">0.01</span>)
est_w &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>d<span class="op">/</span><span class="kw">coef</span>(fit)[<span class="dv">4</span>])
exp_w &lt;-<span class="st"> </span><span class="kw">exp</span>(<span class="op">-</span>d<span class="op">/</span>theta_FF)
<span class="kw">plot</span>(d,est_w, <span class="dt">main =</span> <span class="st">"Correct Model"</span>, <span class="dt">type=</span><span class="st">'l'</span>)
<span class="kw">points</span>(d,<span class="kw">exp</span>(<span class="op">-</span>d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">1</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">points</span>(d,<span class="kw">exp</span>(<span class="op">-</span>d<span class="op">/</span><span class="kw"><a href="../reference/posterior_interval.stapreg.html">posterior_interval</a></span>(fit,<span class="dt">regex_pars =</span> <span class="st">'scale'</span>)[<span class="dv">2</span>]),<span class="dt">col=</span><span class="st">'red'</span>, <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">lty =</span> <span class="dv">2</span>)
<span class="kw">points</span>(d,exp_w, <span class="dt">type=</span><span class="st">'l'</span>,<span class="dt">col=</span><span class="st">'blue'</span>,<span class="dt">lty=</span><span class="dv">3</span>, <span class="dt">lwd =</span> <span class="dv">2</span>)</code></pre></div>
<p><img src="misspecified-kernel_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
