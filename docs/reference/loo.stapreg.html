<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Information criteria and cross-validation — loo.stapreg • rstap</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Information criteria and cross-validation — loo.stapreg" />

<meta property="og:description" content="For models fit using MCMC, compute approximate leave-one-out
  cross-validation (LOO, LOOIC) or, less preferably, the Widely Applicable
  Information Criterion (WAIC) using the loo
  package. Functions for \(K\)-fold cross-validation, model comparison,
  and model weighting/averaging are also provided. Note:
  these functions are not guaranteed to work properly unless the data
  argument was specified when the model was fit. Also, as of loo
  version 2.0.0 the default number of cores is now only 1,  but we
  recommend using as many (or close to as many) cores as possible by setting
  the cores argument or using options(mc.cores = VALUE) to set
  it for an entire session." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">rstap</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/Introduction.html">STAP Introduction</a>
    </li>
    <li>
      <a href="../articles/Spatial_Correlation_I.html">STAP-Spatial_Correlation</a>
    </li>
    <li>
      <a href="../articles/clustered_poisson.html">Spatial Correlation II</a>
    </li>
    <li>
      <a href="../articles/longitudinal-I.html">STAP in a Longitudinal Data Setting</a>
    </li>
    <li>
      <a href="../articles/misspecified-weightfunction.html">Mis-Specified Weight Function</a>
    </li>
    <li>
      <a href="../articles/scale-priors.html">Scale Priors</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Information criteria and cross-validation</h1>
    
    <div class="hidden name"><code>loo.stapreg.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>For models fit using MCMC, compute approximate leave-one-out
  cross-validation (LOO, LOOIC) or, less preferably, the Widely Applicable
  Information Criterion (WAIC) using the <span class="pkg">loo</span>
  package. Functions for \(K\)-fold cross-validation, model comparison,
  and model weighting/averaging are also provided. <strong>Note</strong>:
  these functions are not guaranteed to work properly unless the <code>data</code>
  argument was specified when the model was fit. Also, as of <span class="pkg">loo</span>
  version <code>2.0.0</code> the default number of cores is now only 1,  but we
  recommend using as many (or close to as many) cores as possible by setting
  the <code>cores</code> argument or using <code>options(mc.cores = VALUE)</code> to set
  it for an entire session.</p>
    
    </div>

    <pre class="usage"><span class='co'># S3 method for stapreg</span>
<span class='fu'>loo</span>(<span class='no'>x</span>, <span class='no'>...</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"mc.cores"</span>, <span class='fl'>1</span>),
  <span class='kw'>save_psis</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>k_threshold</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='co'># S3 method for stapreg</span>
<span class='fu'>waic</span>(<span class='no'>x</span>, <span class='no'>...</span>)

<span class='fu'>kfold</span>(<span class='no'>x</span>, <span class='kw'>K</span> <span class='kw'>=</span> <span class='fl'>10</span>, <span class='kw'>save_fits</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>folds</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)

<span class='fu'>compare_models</span>(<span class='no'>...</span>, <span class='kw'>loos</span> <span class='kw'>=</span> <span class='fu'>list</span>(), <span class='kw'>detail</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>)

<span class='co'># S3 method for stapreg_list</span>
<span class='fu'>loo_model_weights</span>(<span class='no'>x</span>, <span class='no'>...</span>, <span class='kw'>cores</span> <span class='kw'>=</span> <span class='fu'>getOption</span>(<span class='st'>"mc.cores"</span>,
  <span class='fl'>1</span>), <span class='kw'>k_threshold</span> <span class='kw'>=</span> <span class='kw'>NULL</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x</th>
      <td><p>For <code>loo</code>, <code>waic</code>, and <code>kfold</code> methods, a fitted
  model object returned by one of the rstanarm modeling functions. See
  stapreg-objects.</p>
<p>For <code>loo_model_weights</code>, <code>x</code> should be a "stapreg_list"
  object, which is a list of fitted model objects created by
  <code>stapreg_list</code>.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>For <code>compare_models</code>, <code>...</code> should contain two or more
  objects returned by the <code>loo</code>, <code>kfold</code>, or <code>waic</code> method
  (see the <strong>Examples</strong> section, below).</p>
<p>For <code>loo_model_weights</code>, <code>...</code> should contain arguments
  (e.g. <code>method</code>) to pass to the default
  <code><a href='http://www.rdocumentation.org/packages/loo/topics/loo_model_weights'>loo_model_weights</a></code> method from the <span class="pkg">loo</span> package.</p></td>
    </tr>
    <tr>
      <th>cores, save_psis</th>
      <td><p>Passed to <code><a href='http://www.rdocumentation.org/packages/loo/topics/loo'>loo</a></code>.</p></td>
    </tr>
    <tr>
      <th>k_threshold</th>
      <td><p>Threshold for flagging estimates of the Pareto shape
parameters \(k\) estimated by <code>loo</code>. See the <em>How to proceed
when <code>loo</code> gives warnings</em> section, below, for details.</p></td>
    </tr>
    <tr>
      <th>K</th>
      <td><p>For <code>kfold</code>, the number of subsets (folds)
into which the data will be partitioned for performing
\(K\)-fold cross-validation. The model is refit <code>K</code> times, each time
leaving out one of the <code>K</code> folds. If <code>K</code> is equal to the total
number of observations in the data then \(K\)-fold cross-validation is
equivalent to exact leave-one-out cross-validation.</p></td>
    </tr>
    <tr>
      <th>save_fits</th>
      <td><p>For <code>kfold</code>, if <code>TRUE</code>, a component <code>'fits'</code>
is added to the returned object to store the cross-validated
stapreg objects and the indices of the omitted
observations for each fold. Defaults to <code>FALSE</code>.</p></td>
    </tr>
    <tr>
      <th>folds</th>
      <td><p>For <code>kfold</code>, an optional integer vector with one element
  per observation in the data used to fit the model. Each element of the
  vector is an integer in <code>1:K</code> indicating to which of the <code>K</code>
  folds the corresponding observation belongs. There are some convenience
  functions available in the <span class="pkg">loo</span> package that create integer vectors to
  use for this purpose (see the <strong>Examples</strong> section below and also the
  <a href='http://www.rdocumentation.org/packages/loo/topics/kfold-helpers'>kfold-helpers</a> page).</p>
<p>If <code>folds</code> is not specified then the default is to call
  <code>loo::<a href='http://www.rdocumentation.org/packages/loo/topics/kfold-helpers'>kfold_split_random</a></code> to randomly partition the data
  into <code>K</code> subsets of equal (or as close to equal as possible) size.</p></td>
    </tr>
    <tr>
      <th>loos</th>
      <td><p>For <code>compare_models</code>, a list of two or more objects returned
by the <code>loo</code>, <code>kfold</code>, or <code>waic</code> method. This argument can
be used as an alternative to passing these objects via <code>...</code>.</p></td>
    </tr>
    <tr>
      <th>detail</th>
      <td><p>For <code>compare_models</code>, if <code>TRUE</code> then extra
information about each model (currently just the model formulas) will be
printed with the output.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>The structure of the objects returned by <code>loo</code> and <code>waic</code>
  methods are documented in detail in the <strong>Value</strong> section in
  <code><a href='http://www.rdocumentation.org/packages/loo/topics/loo'>loo</a></code> and <code><a href='http://www.rdocumentation.org/packages/loo/topics/waic'>waic</a></code> (from the <span class="pkg">loo</span>
  package).</p>
<p><code>kfold</code> returns an object with classes 'kfold' and 'loo' that
  has a similar structure as the objects returned by the <code>loo</code> and
  <code>waic</code> methods.</p>
<p><code>compare_models</code> returns a vector or matrix with class
  'compare.loo'. See the <strong>Comparing models</strong> section below for more
  details.</p>
    
    <h2 class="hasAnchor" id="approximate-loo-cv"><a class="anchor" href="#approximate-loo-cv"></a>Approximate LOO CV</h2>

    <p>The <code>loo</code> method for stapreg objects
  provides an interface to the <span class="pkg">loo</span> package for
  approximate leave-one-out cross-validation (LOO). The LOO Information
  Criterion (LOOIC) has the same purpose as the Akaike Information Criterion
  (AIC) that is used by frequentists. Both are intended to estimate the
  expected log predictive density (ELPD) for a new dataset. However, the AIC
  ignores priors and assumes that the posterior distribution is multivariate
  normal, whereas the functions from the <span class="pkg">loo</span> package do not make this
  distributional assumption and integrate over uncertainty in the parameters.
  This only assumes that any one observation can be omitted without having a
  major effect on the posterior distribution, which can be judged using the
  diagnostic plot provided by the <code><a href='http://www.rdocumentation.org/packages/loo/topics/pareto-k-diagnostic'>plot.loo</a></code> method and the
  warnings provided by the <code><a href='http://www.rdocumentation.org/packages/loo/topics/print.loo'>print.loo</a></code> method (see the
  <em>How to Use the rstanarm Package</em> vignette for an example of this
  process).</p>
<p></p><h3>How to proceed when <code>loo</code> gives warnings (k_threshold)</h3>
    The <code>k_threshold</code> argument to the <code>loo</code> method for <span class="pkg">rstap</span>
  models is provided as a possible remedy when the diagnostics reveal
  problems stemming from the posterior's sensitivity to particular
  observations. Warnings about Pareto \(k\) estimates indicate observations
  for which the approximation to LOO is problematic (this is described in
  detail in Vehtari, Gelman, and Gabry (2017) and the
  <span class="pkg">loo</span> package documentation). The
  <code>k_threshold</code> argument can be used to set the \(k\) value above
  which an observation is flagged. If <code>k_threshold</code> is not <code>NULL</code>
  and there are \(J\) observations with \(k\) estimates above
  <code>k_threshold</code> then when <code>loo</code> is called it will refit the
  original model \(J\) times, each time leaving out one of the \(J\)
  problematic observations. The pointwise contributions of these observations
  to the total ELPD are then computed directly and substituted for the
  previous estimates from these \(J\) observations that are stored in the
  object created by <code>loo</code>.
    <strong>Note</strong>: in the warning messages issued by <code>loo</code> about large
  Pareto \(k\) estimates we recommend setting <code>k_threshold</code> to at
  least \(0.7\). There is a theoretical reason, explained in Vehtari,
  Gelman, and Gabry (2017), for setting the threshold to the stricter value
  of \(0.5\), but in practice they find that errors in the LOO
  approximation start to increase non-negligibly when \(k &gt; 0.7\).
    
    <h2 class="hasAnchor" id="k-fold-cv"><a class="anchor" href="#k-fold-cv"></a>K-fold CV</h2>

    <p>The <code>kfold</code> function performs exact \(K\)-fold
  cross-validation. First the data are randomly partitioned into \(K\)
  subsets of equal (or as close to equal as possible) size (unless the folds
  are specified manually). Then the model is refit \(K\) times, each time
  leaving out one of the \(K\) subsets. If \(K\) is equal to the total
  number of observations in the data then \(K\)-fold cross-validation is
  equivalent to exact leave-one-out cross-validation (to which <code>loo</code> is
  an efficient approximation). The <code>compare_models</code> function is also
  compatible with the objects returned by <code>kfold</code>.</p>
    
    <h2 class="hasAnchor" id="comparing-models"><a class="anchor" href="#comparing-models"></a>Comparing models</h2>

    <p><code>compare_models</code> is a method for the
  <code><a href='http://www.rdocumentation.org/packages/loo/topics/compare'>compare</a></code> function in the <span class="pkg">loo</span> package that
  performs some extra checks to make sure the <span class="pkg">rstanarm</span> models are
  suitable for comparison. These extra checks include verifying that all
  models to be compared were fit using the same outcome variable and
  likelihood family.</p>
<p>If exactly two models are being compared then <code>compare_models</code> returns
  a vector containing the difference in expected log predictive density
  (ELPD) between the models and the standard error of that difference (the
  documentation for <code><a href='http://www.rdocumentation.org/packages/loo/topics/compare'>compare</a></code> in the <span class="pkg">loo</span>
  package has additional details about the calculation of the standard error
  of the difference). The difference in ELPD will be negative if the expected
  out-of-sample predictive accuracy of the first model is higher. If the
  difference is be positive then the second model is preferred.</p>
<p>If more than two models are being compared then <code>compare_models</code>
  returns a matrix with one row per model. This matrix summarizes the objects
  and arranges them in descending order according to expected out-of-sample
  predictive accuracy. That is, the first row of the matrix will be
  for the model with the largest ELPD (smallest LOOIC).
  The columns containing the ELPD difference and the standard error of the 
  difference contain values relative to the model with the best ELPD.
  See the <strong>Details</strong> section at the <code><a href='http://www.rdocumentation.org/packages/loo/topics/compare'>compare</a></code>
  page in the <span class="pkg">loo</span> package for more information.</p>
    
    <h2 class="hasAnchor" id="model-weights"><a class="anchor" href="#model-weights"></a>Model weights</h2>

    <p>The <code>loo_model_weights</code> method can be used to
  compute model weights for a <code>"stapreg_list"</code> object, which is a list
  of fitted model objects made with <code>stapreg_list</code>. The end of
  the <strong>Examples</strong> section has a demonstration. For details see the
  <code><a href='http://www.rdocumentation.org/packages/loo/topics/loo_model_weights'>loo_model_weights</a></code> documentation in the <span class="pkg">loo</span>
  package.</p>
    
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>Vehtari, A., Gelman, A., and Gabry, J. (2017). Practical
  Bayesian model evaluation using leave-one-out cross-validation and WAIC.
  <em>Statistics and Computing</em>. 27(5), 1413--1432.
  doi:10.1007/s11222-016-9696-4. arXiv preprint:
  <a href='http://arxiv.org/abs/1507.04544/'>http://arxiv.org/abs/1507.04544/</a></p>
<p>Yao, Y., Vehtari, A., Simpson, D., and Gelman, A. (2018) Using
  stacking to average Bayesian predictive distributions. <em>Bayesian
  Analysis</em>, advance publication,  doi:10.1214/17-BA1091.
  (<a href='https://projecteuclid.org/euclid.ba/1516093227'>online</a>).</p>
<p>Gabry, J., Simpson, D., Vehtari, A., Betancourt, M., and Gelman,
  A. (2018). Visualization in Bayesian workflow. <em>Journal of the Royal
  Statistical Society Series A</em>, accepted for publication. arXiv preprint:
  <a href='http://arxiv.org/abs/1709.01449'>http://arxiv.org/abs/1709.01449</a>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><ul>
<li><p>The new <a href='http://mc-stan.org/loo/articles/'><span class="pkg">loo</span> package vignettes</a>
  and various <a href='http://mc-stan.org/rstanarm/articles/'><span class="pkg">rstanarm</span> vignettes</a>
  for more examples using <code>loo</code> and related functions with <span class="pkg">rstanarm</span> models.</p></li>
<li><p><code><a href='http://www.rdocumentation.org/packages/loo/topics/pareto-k-diagnostic'>pareto-k-diagnostic</a></code> in the <span class="pkg">loo</span> package for
  more on Pareto \(k\) diagnostics.</p></li>
<li><p><code><a href='log_lik.stapreg.html'>log_lik.stapreg</a></code> to directly access the pointwise
  log-likelihood matrix.</p></li>
</ul></div>
    

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#approximate-loo-cv">Approximate LOO CV</a></li>

      <li><a href="#k-fold-cv">K-fold CV</a></li>

      <li><a href="#comparing-models">Comparing models</a></li>

      <li><a href="#model-weights">Model weights</a></li>

      <li><a href="#references">References</a></li>

      <li><a href="#see-also">See also</a></li>
          </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by Adam Peterson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

